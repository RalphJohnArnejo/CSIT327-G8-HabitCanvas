{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HabitCanvas | Tasks</title>
    <link rel="icon" type="image/x-icon" href="{% static 'favicon.ico' %}">
    <link rel="stylesheet" href="{% static 'css/dashboard.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body>

<!-- NAVIGATION -->
<header class="top-nav">
    <div class="left">
        <img src="{% static 'habitcanvass.jpg' %}" class="logo-img">
        <span class="logo-text">HabitCanvas</span>
    </div>

    <div class="nav-center">
        <a class="nav-btn active"><i class="fa fa-list"></i> Tasks</a>
        <a class="nav-btn"><i class="fa fa-stopwatch"></i> Timer</a>
        <a class="nav-btn"><i class="fa fa-calendar"></i> Calendar</a>
    </div>

    <div class="right">
        <a href="{% url 'logout' %}" class="btn-logout">Logout</a>
    </div>
</header>

<!-- TASKS CONTAINER -->
<div class="page-container">
    <div class="header-row">
        <div>
            <h2>My Tasks</h2>

            <p class="subtext">
                <span id="activeTaskCount">{{ active_count }}</span> active tasks
            </p>
        </div>

        <!-- Open Add Task Modal Button -->
        <a href="#" class="btn-primary" id="openModalBtn">
            <i class="fa fa-plus"></i> Add new task
        </a>
    </div>

    <!-- FILTERS -->
    <div class="filters">
        <select><option>Default</option></select>
        <select><option>All Categories</option></select>
    </div>

    <div class="task-list">
        <!-- ACTIVE TASKS -->
        <div id="active-tasks">
            {% for task in tasks %}
                {% if not task.completed %}
                    {% include "main/partials/task_card.html" with task=task %}
                {% endif %}
            {% endfor %}
        </div>

        <h3 class="completed-title">Completed Tasks</h3>

        <!-- COMPLETED TASKS -->
        <div id="completed-tasks">
            {% for task in tasks %}
                {% if task.completed %}
                    {% include "main/partials/task_card.html" with task=task %}
                {% endif %}
            {% endfor %}
        </div>
    </div>
</div>

<!-- ADD TASK MODAL -->
<div id="taskModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Add New Task</h2>

        <form id="addTaskForm" method="POST" action="{% url 'add_task' %}">
            {% csrf_token %}

            <label for="title">Task Title</label>
            <input type="text" name="title" id="title" required>

            <label for="category">Category</label>
            <select name="category" id="category" required>
                <option value="School">School</option>
                <option value="Personal">Personal</option>
                <option value="Work">Work</option>
            </select>

            <label for="difficulty">Difficulty</label>
            <select name="difficulty" id="difficulty" required>
                <option value="Easy">Easy</option>
                <option value="Medium">Medium</option>
                <option value="Hard">Hard</option>
            </select>

            <label for="due_date">Due Date</label>
            <input type="date" name="due_date" id="due_date">

            <label for="priority">Priority</label>
            <select name="priority" id="priority">
                <option value="0">Low</option>
                <option value="1">Medium</option>
                <option value="2">High</option>
            </select>

            <button type="submit" class="btn-primary">Add Task</button>
        </form>
    </div>
</div>

<!-- EDIT TASK MODAL -->
<div id="editTaskModal" class="modal">
    <div class="modal-content">
        <span class="close">&times;</span>
        <h2>Edit Task</h2>

        <form id="editTaskForm" method="POST">
            {% csrf_token %}

            <label for="edit_title">Task Title</label>
            <input type="text" name="title" id="edit_title" required>

            <label for="edit_category">Category</label>
            <select name="category" id="edit_category" required>
                <option value="School">School</option>
                <option value="Personal">Personal</option>
                <option value="Work">Work</option>
            </select>

            <label for="edit_difficulty">Difficulty</label>
            <select name="difficulty" id="edit_difficulty" required>
                <option value="Easy">Easy</option>
                <option value="Medium">Medium</option>
                <option value="Hard">Hard</option>
            </select>

            <label for="edit_due_date">Due Date</label>
            <input type="date" name="due_date" id="edit_due_date">

            <label for="edit_priority">Priority</label>
            <select name="priority" id="edit_priority">
                <option value="0">Low</option>
                <option value="1">Medium</option>
                <option value="2">High</option>
            </select>

            <button type="submit" class="btn-primary">Save Changes</button>
        </form>
    </div>
</div>

<!-- FOOTER -->
<footer>
    Â© 2025 HabitCanvas | Cebu Institute of Technology - University
</footer>

<!-- JAVASCRIPT -->
<script>
/* ---------------------------
   Modal Open / Close (Add Task)
---------------------------- */
const addModal = document.getElementById("taskModal");
const openAddBtn = document.getElementById("openModalBtn");
const closeAdd = addModal.querySelector(".close");

openAddBtn.onclick = e => {
    e.preventDefault();
    addModal.style.display = "block";
};

closeAdd.onclick = () => addModal.style.display = "none";
window.onclick = event => {
    if (event.target === addModal) addModal.style.display = "none";
};

/* ---------------------------
   Modal Open / Close (Edit Task)
---------------------------- */
const editModal = document.getElementById("editTaskModal");
const editForm = document.getElementById("editTaskForm");
const closeEdit = editModal.querySelector(".close");

document.querySelectorAll(".edit-btn").forEach(btn => {
    btn.addEventListener("click", e => {
        e.preventDefault();

        const id = btn.dataset.id;
        editForm.action = `/tasks/edit/${id}/`;  // update form URL

        // Prefill values
        document.getElementById("edit_title").value = btn.dataset.title;
        document.getElementById("edit_category").value = btn.dataset.category;
        document.getElementById("edit_difficulty").value = btn.dataset.difficulty;
        document.getElementById("edit_due_date").value = btn.dataset.due;
        document.getElementById("edit_priority").value = btn.dataset.priority;

        editModal.style.display = "block";
    });
});

closeEdit.onclick = () => editModal.style.display = "none";
window.onclick = event => {
    if (event.target === editModal) editModal.style.display = "none";
};
</script>

</body>
</html>
